<div class="overview-service">
  <div class="service-heading">
    <div ng-if="displayRoute">
      <small class="text-muted text-uppercase">
        Service:
        <a ng-href="{{service | navigateResourceURL}}" class="subtle-link">{{service.metadata.name}}</a>
      </small>
      <h2 class="service-title truncate">
        <a ng-if="displayRoute | isWebRoute"
           ng-href="{{displayRoute | routeWebURL}}">{{displayRoute | routeLabel}}</a>
        <span ng-if="!(displayRoute | isWebRoute)">{{displayRoute | routeLabel}}</span>
          <span ng-if="routeWarnings && routes.length === 1">
            <route-warnings warnings="routeWarnings"></route-warnings>
          </span>
        </span>
      </h2>
      <div ng-if="routeWarnings && routes.length > 1" class="small text-muted">
        <span class="pficon pficon-warning-triangle-o" aria-hidden="true"></span>
        This service has <a ng-href="project/{{service.metadata.namespace}}/browse/routes">routes</a> with warnings.
      </div>
    </div>
    <div ng-if="!displayRoute">
      <div ng-if="!displayRouteByService[serviceId]" class="pull-right small">
        <a ng-href="project/{{service.metadata.namespace}}/create-route?service={{service.metadata.name}}">Create Route</a>
      </div>
      <small class="text-muted text-uppercase">Service</small>
      <h2 class="service-title truncate">
        <a ng-href="{{service | navigateResourceURL}}">{{service.metadata.name}}</a>
      </h2>
    </div>
  </div>
  <div class="service-body">
    <div ng-repeat="dc in deploymentConfigs">
      <div row mobile="column" ng-repeat="pipeline in recentPipelines[dc.metadata.name] | orderObjectsByDate : true track by (pipeline | uid)">
        <div column grow="4">
          <build-pipeline flex build="pipeline"></build-pipeline>
        </div>
      </div>
    </div>
    <div ng-if="!(deployments | hashSize)" class="pad-md">
      There are no deployments for this service.
    </div>
    <!-- FIXME: ng-if is not exactly right, need to understand how to show dep status -->
    <div ng-repeat="deployment in deployments | orderObjectsByDate : true track by (deployment | uid)"
         ng-if="isDeploymentVisible(deployment)">

      <div row tablet="column">
        <div column
             tablet="row"
             ng-if="pipelinesByDeployment[deployment.metadata.name]"
             ng-attr-grow="{{(pipelinesByDeployment[deployment.metadata.name] | isIncompleteBuild) ? 3 : undefined}}">
          <build-pipeline
              flex
              build="pipelinesByDeployment[deployment.metadata.name]"
              collapse-stages="!(pipelinesByDeployment[deployment.metadata.name] | isIncompleteBuild)">
          </build-pipeline>
        </div>

        <div column mobile="row" grow="1">
          <div row mobile="column" class="deployment-block">
            <div
                 column
                 grow="3"
                 ng-if="!(pipelinesByDeployment[deployment.metadata.name] | isIncompleteBuild)"
                 class="deployment-details">
              <deployment-pipeline-details
                  ng-if="!(pipelinesByDeployment[deployment.metadata.name] | isIncompleteBuild)"
                  flex
                  deployment="deployment">
              </deployment-pipeline-details>
            </div>
            <div column class="deployment-donut">
              <deployment-donut
                  rc="deployment"
                  deployment-config="deploymentConfigs[(deployment | annotation : 'deploymentConfig')]"
                  pods="podsByDeployment[deployment.metadata.name]"
                  hpa="getHPA(deployment.metadata.name, (deployment | annotation : 'deploymentConfig'))"
                  limit-ranges="limitRanges"
                  scalable="isScalableDeployment(deployment, deploymentConfigs, hpaByDc, hpaByRc, scalableDeploymentByConfig)"
                  alerts="alerts">
              </deployment-donut>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
